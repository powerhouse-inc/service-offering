# MCP Tools Reference

Complete reference for the Reactor-MCP tools used to manage documents and drives in the Powerhouse/Vetra ecosystem. The MCP (Model Context Protocol) server bridges AI agents and Powerhouse document management.

---

## Mandatory Rules

1. **Never set document IDs manually** -- they are auto-generated by `createDocument`
2. **Batch multiple actions** in a single `addActions` call to minimize API calls
3. **Always call `getDocumentModelSchema`** before `addActions` to understand the required input structure
4. **Add documents to the `vetra-{hash}` drive** unless otherwise specified
5. **If MCP is unavailable**, ask the user to run `ph vetra` in a separate terminal

---

## MCP Tools

### `getDocument`

Retrieves a document by its ID.

```typescript
mcp__reactor-mcp__getDocument({ id: "<document-id>" })
```

**Returns**: Full document object including state, operations history, and metadata.

### `createDocument`

Creates a new document of a specified type.

```typescript
mcp__reactor-mcp__createDocument({ documentType: "powerhouse/document-model" })
```

**Parameters**:
- `documentType` (required): The document type string
- `documentId` (optional): Custom ID (not recommended -- let it auto-generate)

**Returns**: The created document with auto-generated ID.

### `getDocuments`

Lists documents in a drive.

```typescript
mcp__reactor-mcp__getDocuments({ parentId: "<drive-id>" })
```

### `deleteDocument`

Deletes a document.

```typescript
mcp__reactor-mcp__deleteDocument({ documentId: "<document-id>" })
```

### `addActions`

Adds one or more actions to a document. This is the primary tool for modifying documents.

```typescript
mcp__reactor-mcp__addActions({
  documentId: "<document-id>",
  actions: [
    {
      type: "ACTION_NAME",
      scope: "global",
      input: { /* action-specific input */ }
    }
  ]
})
```

**Parameters**:
- `documentId` (required): Target document ID
- `actions` (required): Array of action objects, each with:
  - `type`: Action name (e.g., `SET_MODEL_NAME`, `ADD_MODULE`)
  - `scope`: `"global"` or `"local"`
  - `input`: Action-specific payload

### `getDrives`

Lists all available drives.

```typescript
mcp__reactor-mcp__getDrives()
```

### `getDrive`

Gets a specific drive by ID.

```typescript
mcp__reactor-mcp__getDrive({ driveId: "<drive-id>" })
```

### `addDrive`

Creates a new drive.

```typescript
mcp__reactor-mcp__addDrive({
  driveInput: {
    global: { name: "My Drive" },
    local: { availableOffline: true }
  }
})
```

### `deleteDrive`

Deletes a drive.

```typescript
mcp__reactor-mcp__deleteDrive({ driveId: "<drive-id>" })
```

### `addRemoteDrive`

Connects to a remote drive.

```typescript
mcp__reactor-mcp__addRemoteDrive({
  url: "https://server.com/d/<drive-id>",
  options: {
    availableOffline: true,
    pullInterval: 3000,
    pullFilter: {
      documentType: ["powerhouse/todo-list"],
      branch: ["main"]
    }
  }
})
```

### `getDocumentModels`

Lists all available document model types.

```typescript
mcp__reactor-mcp__getDocumentModels()
```

### `getDocumentModelSchema`

Gets the full schema of a document model type -- including all operations, their input schemas, and state schemas.

```typescript
mcp__reactor-mcp__getDocumentModelSchema({ type: "powerhouse/document-model" })
```

**CRITICAL**: Always call this before `addActions` to understand the required input structure.

---

## Drive Types

### Vetra Drive (`vetra-{hash}`)

Contains **source documents**: document models and document editors. Used for development. Add document model and editor definitions here.

### Preview Drive (`preview-{hash}`, named "Vetra Preview")

Contains **demo and preview documents** (document instances). Used for showcasing and testing document models. Add actual document instances here.

---

## Working with Drives

### Pre-Requisite

Always get the drive schema first:

```typescript
mcp__reactor-mcp__getDocumentModelSchema({ type: "powerhouse/document-drive" })
```

### Drive Operations

| Operation | Description |
|-----------|-------------|
| `ADD_FILE` | Add a document to the drive |
| `ADD_FOLDER` | Create a new folder |
| `DELETE_NODE` | Remove a file or folder (NOT "DELETE_FILE") |
| `UPDATE_NODE` | Update node properties |
| `MOVE_NODE` | Move a node to a different location |

### Adding a Document to a Drive

```typescript
mcp__reactor-mcp__addActions({
  documentId: "<drive-id>",
  actions: [{
    type: "ADD_FILE",
    scope: "global",
    input: {
      id: "<document-id>",
      name: "My Document",
      documentType: "powerhouse/my-model"
    }
  }]
})
```

---

## All 37 Document Model Operations

These operations are used with `addActions` on documents of type `powerhouse/document-model`.

### Header Management (6)

| Operation | Input Fields |
|-----------|-------------|
| `SET_MODEL_NAME` | `{ name: String }` |
| `SET_MODEL_ID` | `{ id: String }` |
| `SET_MODEL_EXTENSION` | `{ extension: String }` |
| `SET_MODEL_DESCRIPTION` | `{ description: String }` |
| `SET_AUTHOR_NAME` | `{ authorName: String }` |
| `SET_AUTHOR_WEBSITE` | `{ authorWebsite: String }` |

### Module Management (5)

| Operation | Input Fields |
|-----------|-------------|
| `ADD_MODULE` | `{ id: String!, name: String! }` |
| `SET_MODULE_NAME` | `{ id: String!, name: String! }` |
| `SET_MODULE_DESCRIPTION` | `{ id: String!, description: String }` |
| `DELETE_MODULE` | `{ id: String! }` |
| `REORDER_MODULES` | `{ order: [String!]! }` |

### Operation Management (9)

| Operation | Input Fields |
|-----------|-------------|
| `ADD_OPERATION` | `{ id: String!, name: String!, moduleId: String! }` |
| `SET_OPERATION_NAME` | `{ id: String!, name: String! }` |
| `SET_OPERATION_SCHEMA` | `{ id: String!, schema: String }` (GraphQL input type) |
| `SET_OPERATION_DESCRIPTION` | `{ id: String!, description: String }` |
| `SET_OPERATION_TEMPLATE` | `{ id: String!, template: String }` |
| `SET_OPERATION_REDUCER` | `{ id: String!, reducer: String }` (JS code, no function wrapper) |
| `MOVE_OPERATION` | `{ id: String!, targetModuleId: String! }` |
| `DELETE_OPERATION` | `{ id: String! }` |
| `REORDER_MODULE_OPERATIONS` | `{ moduleId: String!, order: [String!]! }` |

### Operation Error Management (7)

| Operation | Input Fields |
|-----------|-------------|
| `ADD_OPERATION_ERROR` | `{ operationId: String!, id: String!, code: String!, name: String!, description: String }` |
| `SET_OPERATION_ERROR_CODE` | `{ errorId: String!, code: String! }` |
| `SET_OPERATION_ERROR_NAME` | `{ errorId: String!, name: String! }` |
| `SET_OPERATION_ERROR_DESCRIPTION` | `{ errorId: String!, description: String }` |
| `SET_OPERATION_ERROR_TEMPLATE` | `{ errorId: String!, template: String }` |
| `DELETE_OPERATION_ERROR` | `{ errorId: String! }` |
| `REORDER_OPERATION_ERRORS` | `{ operationId: String!, order: [String!]! }` |

### State Management (6)

| Operation | Input Fields |
|-----------|-------------|
| `SET_STATE_SCHEMA` | `{ schema: String!, scope: "global" \| "local" }` |
| `SET_INITIAL_STATE` | `{ initialValue: String!, scope: "global" \| "local" }` |
| `ADD_STATE_EXAMPLE` | `{ example: Object, scope: "global" \| "local" }` |
| `UPDATE_STATE_EXAMPLE` | `{ id: String!, example: Object, scope: "global" \| "local" }` |
| `DELETE_STATE_EXAMPLE` | `{ id: String!, scope: "global" \| "local" }` |
| `REORDER_STATE_EXAMPLES` | `{ order: [String!]!, scope: "global" \| "local" }` |

---

## Batching Pattern

Always batch multiple actions in a single `addActions` call:

```typescript
mcp__reactor-mcp__addActions({
  documentId: "<doc-id>",
  actions: [
    { type: "SET_MODEL_NAME", scope: "global", input: { name: "Todo List" } },
    { type: "SET_MODEL_ID", scope: "global", input: { id: "powerhouse/todo-list" } },
    { type: "SET_MODEL_EXTENSION", scope: "global", input: { extension: "phtodo" } },
    { type: "SET_MODEL_DESCRIPTION", scope: "global", input: { description: "A simple todo list" } },
    { type: "SET_AUTHOR_NAME", scope: "global", input: { authorName: "Powerhouse" } },
  ]
})
```

---

## Document Confirmation Table

| Document Type | Confirmation Action | Input |
|---|---|---|
| `powerhouse/document-editor` | `SET_EDITOR_STATUS` | `{ status: "CONFIRMED" }` |
| `powerhouse/app` | `SET_APP_STATUS` | `{ status: "CONFIRMED" }` |
| `powerhouse/processor` | `SET_PROCESSOR_STATUS` | `{ status: "CONFIRMED" }` |
| `powerhouse/subgraph` | `SET_SUBGRAPH_STATUS` | `{ status: "CONFIRMED" }` |

Documents in DRAFT status are ignored by the code generator. Always confirm after setup.

---

## Scope Selection Guide

- **`scope: "global"`**: State shared among all users. Use for primary document data, structure, and content.
- **`scope: "local"`**: State private to each user. Use for preferences, UI state, personal annotations.

---

## Common Workflow Patterns

### Creating a Document Model

```
1. getDocumentModelSchema({ type: "powerhouse/document-model" })
2. createDocument({ documentType: "powerhouse/document-model" })
3. addActions: SET_MODEL_NAME, SET_MODEL_ID, SET_MODEL_EXTENSION, etc.
4. addActions: SET_STATE_SCHEMA (global and/or local)
5. addActions: SET_INITIAL_STATE
6. addActions: ADD_MODULE (for each module)
7. addActions: ADD_OPERATION (for each operation)
8. addActions: SET_OPERATION_SCHEMA (for each operation)
9. addActions: ADD_OPERATION_ERROR (for each error)
10. addActions: SET_OPERATION_REDUCER (for each operation)
11. Add to vetra drive: addActions on drive with ADD_FILE
```

### Creating an Editor

```
1. getDocumentModelSchema({ type: "powerhouse/document-editor" })
2. createDocument({ documentType: "powerhouse/document-editor" })
3. addActions: SET_EDITOR_NAME, SET_EDITOR_DOCUMENT_TYPES
4. addActions: SET_EDITOR_STATUS with status: "CONFIRMED"
5. Add to vetra drive: addActions on drive with ADD_FILE
6. Wait for code generation, then implement
```

### Creating a Document Instance (for Preview)

```
1. getDocumentModelSchema({ type: "powerhouse/<your-model-type>" })
2. createDocument({ documentType: "powerhouse/<your-model-type>" })
3. addActions: populate with data
4. Add to preview drive: addActions on drive with ADD_FILE
```

---

## Switchboard GraphQL API

The Switchboard provides a GraphQL API for querying document data.

### Query Example

```graphql
query {
  document(id: "doc-123") {
    id
    name
    documentType
    state {
      global
      local
    }
    operations {
      index
      type
      timestamp
    }
  }
}
```

### Mutation Example

```graphql
mutation {
  pushUpdates(
    driveId: "drive-123"
    operations: [{ type: "ADD_TODO", input: { id: "1", title: "Test" } }]
  ) {
    success
    errors
  }
}
```

---

## Error Handling

### Common MCP Errors

| Error | Cause | Fix |
|-------|-------|-----|
| "Document not found" | Invalid document ID | Check ID from createDocument response |
| "Invalid action type" | Typo in action type | Check schema with getDocumentModelSchema |
| "Missing required field" | Incomplete action input | Review input schema requirements |
| "MCP server unavailable" | Server not running | Run `ph vetra` in separate terminal |

### Pre-Implementation Checklist

Before making any MCP calls:
- [ ] Called `getDocumentModelSchema` for the target document type
- [ ] Reviewed input schema requirements for each action
- [ ] Ensured all required parameters are included (especially `id`, `scope`)
- [ ] Planned action batching to minimize calls
